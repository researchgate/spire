#!/usr/bin/env groovy
library 'researchgate@v1'

withDocker('node:8') {
  withNotifications('Team Stargazer') {
    stage('Prepare') {
      sh 'echo "//nexus3.rgoffice.net/repository/npm-internal/:_authToken=$NPM_TOKEN" >> ~/.npmrc'
      sh 'node --version'
      sh 'yarn --version'
      sh 'yarn'
    }

    stage('Lint') {
      sh 'yarn lint'
    }

    stage('Test') {
      sh 'yarn test'
    }

    stage('Release') {
      withEnv([
        'GIT_AUTHOR_NAME="Team Stargazer"',
        'GIT_AUTHOR_EMAIL="team-stargazer@researchgate.net"',
        'GIT_COMMITTER_NAME="Team Stargazer"',
        'GIT_COMMITTER_EMAIL="team-stargazer@researchgate.net"',
      ]) {
        sh 'yarn release'
      }
    }
  }
}